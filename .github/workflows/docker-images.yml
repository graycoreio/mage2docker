name: Docker Image CI

on:
  # release:
  #   types: [published]
  push:
    branches:
      - docker_auto_builds

jobs:
  build-php-7-2-alpine:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Build the Alpine PHP image
        run: 
          docker build ./php/7.2/alpine \
            -t graycore/magento-php:7.2-fpm-alpine-${GITHUB_REF##*/} \
            -t graycore/magento-php:7.2-fpm-alpine
  build-php-7-2-alpine-develop:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Build the Alpine Develop PHP image
        run: docker build ./php/7.2/alpine-develop
          -t graycore/magento-php:7.2-fpm-alpine-${GITHUB_REF##*/}
          -t graycore/magento-php:7.2-fpm-alpine
  build-nginx-1-17-alpine-develop:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Build the Alpine Develop Nginx image
        run: docker build ./nginx/1.17/alpine-develop
          -t graycore/magento-php:7.2-fpm-alpine-${GITHUB_REF##*/}
          -t graycore/magento-php:7.2-fpm-alpine
